{% extends "base.html" %}

{% block title %}{{ bolao.nome }}{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 2rem auto;">
    
    <!-- CabeÃ§alho -->
    <div style="background: var(--cinza); padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
        <div class="bolao-header" style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <h1 style="margin-bottom: 0.5rem;">{{ bolao.nome }}</h1>
                <div style="color: var(--texto-fraco); font-size: 0.95rem;">
                    {{ bolao.competicao.nome if bolao.competicao else 'MÃºltiplas competiÃ§Ãµes' }}
                </div>
            </div>
            <div style="text-align: right;">
                <div style="background: var(--cinza-medio); padding: 0.5rem 1rem; border-radius: 6px; margin-bottom: 0.5rem;">
                    <div style="font-size: 0.8rem; color: var(--texto-fraco);">CÃ³digo de Convite</div>
                    <div style="font-size: 1.5rem; font-weight: 600; color: var(--verde); font-family: monospace;">
                        {{ bolao.codigo_convite }}
                    </div>
                </div>
                
                <!-- BotÃµes de Compartilhamento -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.5rem;">
                    <button onclick="copiarLink()" style="background: var(--cinza-medio); color: var(--texto); border: none; 
                           padding: 0.5rem; border-radius: 6px; font-size: 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.3rem;">
                        ğŸ”— Copiar Link
                    </button>
                    <button onclick="compartilharWhatsApp()" style="background: #25D366; color: white; border: none; 
                           padding: 0.5rem; border-radius: 6px; font-size: 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.3rem;">
                        ğŸ“± WhatsApp
                    </button>
                </div>
                
                <div id="msg-compartilhar" style="margin-top: 0.5rem; font-size: 0.75rem; text-align: center; display: none; color: var(--verde);"></div>
                <div style="font-size: 0.8rem; color: var(--texto-fraco);">
                    Compartilhe com seus amigos
                </div>
                
                {% if eh_dono %}
                <button onclick="atualizarJogosBolao({{ bolao.id }})" id="btn-atualizar-jogos"
                    style="margin-top: 0.5rem; width: 100%; background: var(--amarelo); color: #000; border: none; 
                           padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.85rem;">
                    ğŸ”„ Atualizar Jogos
                </button>
                <div id="msg-atualizar-jogos" style="margin-top: 0.5rem; font-size: 0.75rem; display: none;"></div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid var(--cinza-medio);">
        <a href="#" onclick="mostrarTab('ranking'); return false;" id="tab-ranking"
           style="padding: 1rem 1.5rem; text-decoration: none; color: var(--verde); border-bottom: 3px solid var(--verde);">
            ğŸ† Ranking
        </a>
        <a href="#" onclick="mostrarTab('palpites'); return false;" id="tab-palpites"
           style="padding: 1rem 1.5rem; text-decoration: none; color: var(--texto-fraco); border-bottom: 3px solid transparent;">
            ğŸ¯ Meus Palpites
        </a>
        <a href="#" onclick="mostrarTab('todos-palpites'); return false;" id="tab-todos-palpites"
           style="padding: 1rem 1.5rem; text-decoration: none; color: var(--texto-fraco); border-bottom: 3px solid transparent;">
            ğŸ“‹ Todos os Palpites
        </a>
        <a href="#" onclick="mostrarTab('regras'); return false;" id="tab-regras"
           style="padding: 1rem 1.5rem; text-decoration: none; color: var(--texto-fraco); border-bottom: 3px solid transparent;">
            ğŸ“‹ Regras
        </a>
        
        {% if eh_dono %}
        <a href="#" onclick="mostrarTab('participantes'); return false;" id="tab-participantes"
           style="padding: 1rem 1.5rem; text-decoration: none; color: var(--texto-fraco); border-bottom: 3px solid transparent;">
            ğŸ‘¥ Participantes
        </a>
        {% endif %}
    </div>

    <!-- ConteÃºdo das Tabs -->
    
    <div id="content-ranking">
        <h2 style="margin-bottom: 1.5rem;">ğŸ† Ranking</h2>
        
        {% if bolao.participantes.count() > 0 %}
        <div style="background: var(--cinza); border-radius: 8px; overflow: hidden;">
            <div class="ranking-table">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--verde);">
                        <th style="text-align: center; padding: 0.7rem; color: var(--texto-fraco); width: 60px;">POS</th>
                        <th style="text-align: left; padding: 0.7rem; color: var(--texto-fraco);">PARTICIPANTE</th>
                        <th style="text-align: center; padding: 0.7rem; color: var(--texto-fraco);">PONTOS</th>
                    </tr>
                </thead>
                <tbody>
                    {% set participantes_ordenados = bolao.participantes.all()|sort(attribute='pontos_totais', reverse=True) %}
                    {% for part in participantes_ordenados %}
                    <tr style="border-bottom: 1px solid var(--cinza-medio);">
                        <td style="text-align: center; padding: 1rem; font-weight: 600; font-size: 1.1rem;">
                            {% if loop.index == 1 %}
                                <span style="color: var(--amarelo);">ğŸ¥‡</span>
                            {% elif loop.index == 2 %}
                                <span style="color: #C0C0C0;">ğŸ¥ˆ</span>
                            {% elif loop.index == 3 %}
                                <span style="color: #CD7F32;">ğŸ¥‰</span>
                            {% else %}
                                {{ loop.index }}Âº
                            {% endif %}
                        </td>
                        <td style="padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="font-size: 2rem;">
                                    {% if part.usuario.avatar_tipo == 'sugerido' and part.usuario.avatar_sugerido_id %}
                                        {{ ['âš½', 'ğŸ†', 'ğŸ‘Ÿ', 'ğŸ¥…', 'ğŸ”¥', 'â­', 'âš¡', 'ğŸ’ª', 'ğŸ¯', 'ğŸ‘Š', 'ğŸš€', 'ğŸ’'][part.usuario.avatar_sugerido_id - 1] }}
                                    {% elif part.usuario.avatar_tipo == 'upload' and part.usuario.avatar_custom_url %}
                                        <img src="{{ part.usuario.avatar_custom_url }}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                                    {% else %}
                                        ğŸ‘¤
                                    {% endif %}
                                </span>
                                <div>
                                    <div style="font-weight: 600;">{{ part.usuario.nome_completo or part.usuario.username }}</div>
                                    {% if part.usuario.time_coracao_id %}
                                    <div style="font-size: 0.85rem; color: var(--texto-fraco);">
                                        {{ part.usuario.time_coracao.nome if part.usuario.time_coracao else '' }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                        <td style="text-align: center; padding: 1rem;">
                            <div style="font-size: 1.5rem; font-weight: 600; color: var(--verde);">
                                {{ part.pontos_totais }}
                            </div>
                        </td>
                    </tr>
                    
                    {% endfor %}
                </tbody>
            </table></div>
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem; color: var(--texto-fraco);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ‘¥</div>
            <p>Nenhum participante ainda.</p>
            <p style="margin-top: 0.5rem;">Compartilhe o cÃ³digo <strong>{{ bolao.codigo_convite }}</strong> com seus amigos!</p>
        </div>
        {% endif %}
    </div>
    

    <div id="content-palpites" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2>Meus Palpites</h2>
            
            <div class="filtros-container" style="display: flex; gap: 1rem;" >
                <!-- Filtro Status -->
                <select id="filtro-status" onchange="filtrarJogos()" 
                    style="padding: 0.6rem 1rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 0.9rem;">
                    <option value="todos">Todos os jogos</option>
                    <option value="abertos">Pode palpitar</option>
                    <option value="encerrados">JÃ¡ encerrados</option>
                </select>
                
                <!-- Filtro Rodada -->
                <select id="filtro-rodada" onchange="filtrarJogos()"
                    style="padding: 0.6rem 1rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 0.9rem;">
                    <option value="">Todas as rodadas</option>
                    {% set rodadas = [] %}
                    {% for jogo in jogos %}
                        {% set rodada_num = jogo.rodada.replace('Regular Season - ', '').replace('Rodada ', '') %}
                        {% if rodada_num not in rodadas %}
                            {% set _ = rodadas.append(rodada_num) %}
                        {% endif %}
                    {% endfor %}
                    {% for rodada in rodadas|map('int')|sort %}
                        <option value="{{ rodada }}">Rodada {{ rodada }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div style="display: grid; gap: 1rem;" id="lista-jogos">
            {% for jogo in jogos %}
            <div class="jogo-card jogo-item" 
                 data-status="{% if jogo.gols_casa is none %}aberto{% else %}encerrado{% endif %}"
                 data-rodada="{{ jogo.rodada.replace('Regular Season - ', '').replace('Rodada ', '') }}"
                 style="background: var(--cinza); padding: 1.5rem; border-radius: 8px;">
                <div style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 2rem;">
                    
                    <!-- Time Casa -->
                    <div style="text-align: right;">
                        <div style="font-weight: 600; font-size: 1.1rem;">{{ jogo.time_casa.nome }}</div>
                        <div style="color: var(--texto-fraco); font-size: 0.85rem; margin-top: 0.3rem;">
                            <div>{{ jogo.competicao.nome }}</div>
                            {% if jogo.gols_casa is not none %}
                                Resultado: {{ jogo.gols_casa }}
                            {% else %}
                                {{ jogo.data[:10] if jogo.data else 'A definir' }}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Palpite -->
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        {% if jogo.gols_casa is none %}
                            <input type="number" min="0" max="99" 
                                   value="{{ palpites_usuario[jogo.id].gols_casa_palpite if jogo.id in palpites_usuario else '' }}"
                                   id="casa-{{ jogo.id }}"
                                   style="width: 60px; padding: 0.5rem; text-align: center; background: var(--cinza-medio); 
                                          border: 1px solid var(--cinza-medio); border-radius: 6px; color: var(--texto); 
                                          font-size: 1.2rem; font-weight: 600;">
                            <span style="font-size: 1.2rem; color: var(--texto-fraco);">Ã—</span>
                            <input type="number" min="0" max="99"
                                   value="{{ palpites_usuario[jogo.id].gols_fora_palpite if jogo.id in palpites_usuario else '' }}"
                                   id="fora-{{ jogo.id }}"
                                   style="width: 60px; padding: 0.5rem; text-align: center; background: var(--cinza-medio); 
                                          border: 1px solid var(--cinza-medio); border-radius: 6px; color: var(--texto); 
                                          font-size: 1.2rem; font-weight: 600;">
                            <button onclick="salvarPalpite({{ jogo.id }}, {{ bolao.id }})"
                                    style="background: var(--verde); color: #000; border: none; padding: 0.5rem 1rem; 
                                           border-radius: 6px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                                Salvar
                            </button>
                        {% else %}
                            <div style="text-align: center;">
                                {% if jogo.id in palpites_usuario %}
                                    <div style="font-size: 1.2rem; font-weight: 600;">
                                        {{ palpites_usuario[jogo.id].gols_casa_palpite }} Ã— {{ palpites_usuario[jogo.id].gols_fora_palpite }}
                                    </div>
                                    <div style="margin-top: 0.3rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.85rem; font-weight: 600;
                                               background: {% if palpites_usuario[jogo.id].pontos_obtidos >= 5 %}var(--verde){% elif palpites_usuario[jogo.id].pontos_obtidos > 0 %}var(--amarelo){% else %}#e74c3c{% endif %}; 
                                               color: #000;">
                                        {{ palpites_usuario[jogo.id].pontos_obtidos }} pts
                                    </div>
                                    <!-- BotÃ£o Comprovante -->
                                    <a href="/comprovante/{{ palpites_usuario[jogo.id].id }}" target="_blank"
                                       style="display: inline-block; margin-top: 0.5rem; padding: 0.3rem 0.6rem; background: var(--cinza-medio); 
                                              color: var(--texto); text-decoration: none; border-radius: 4px; font-size: 0.75rem;">
                                        ğŸ“„ Comprovante
                                    </a>
                                {% else %}
                                    <div style="color: var(--texto-fraco); font-size: 0.9rem;">Sem palpite</div>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Time Fora -->
                    <div style="text-align: left;">
                        <div style="font-weight: 600; font-size: 1.1rem;">{{ jogo.time_fora.nome }}</div>
                        <div style="color: var(--texto-fraco); font-size: 0.85rem; margin-top: 0.3rem;">
                            <div>{{ jogo.competicao.nome }}</div>
                            {% if jogo.gols_fora is not none %}
                                Resultado: {{ jogo.gols_fora }}
                            {% else %}
                                {{ jogo.data[:10] if jogo.data else 'A definir' }}
                            {% endif %}
                        </div>
                    </div>
                    
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <!-- Tab: Todos os Palpites -->
    <div id="content-todos-palpites" style="display: none;">
        <h2 style="margin-bottom: 1.5rem;">ğŸ“‹ Todos os Palpites</h2>
        
        <p style="color: var(--texto-fraco); margin-bottom: 2rem;">
            Clique em um jogo para ver os palpites de todos os participantes
        </p>
        
        <!-- Lista de Jogos -->
        <div style="display: grid; gap: 1rem;">
            {% for jogo in jogos %}
            {% set jogo_encerrado = jogo.gols_casa is not none %}
            {% set jogo_iniciado = jogo.data and jogo.data < agora %}
            
            {% if jogo_iniciado or jogo_encerrado %}
            <div style="background: var(--cinza); padding: 1.2rem; border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                 onclick="toggleDetalhesJogo({{ jogo.id }})"
                 onmouseover="this.style.background='var(--cinza-medio)'"
                 onmouseout="this.style.background='var(--cinza)'">
                
                <!-- Resumo do Jogo -->
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                            <span style="font-weight: 600; font-size: 1.1rem;">
                                {{ jogo.time_casa.nome }} 
                                {% if jogo_encerrado %}
                                    <span style="color: var(--verde);">{{ jogo.gols_casa }} x {{ jogo.gols_fora }}</span>
                                {% else %}
                                    <span style="color: var(--amarelo);">vs</span>
                                {% endif %}
                                {{ jogo.time_fora.nome }}
                            </span>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--texto-fraco);">
                            {{ jogo.competicao.nome }} â€¢ {{ jogo.rodada }}
                            {% if jogo_encerrado %}
                                â€¢ <span style="color: var(--verde);">Encerrado</span>
                            {% else %}
                                â€¢ <span style="color: var(--amarelo);">Em andamento</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div style="text-align: right;">
                       
                        {% set palpites_deste_jogo = todos_palpites|selectattr('jogo_id', 'equalto', jogo.id)|list %}
                        <div style="font-size: 0.9rem; color: var(--texto-fraco);">
                            ğŸ‘¥ {{ palpites_deste_jogo|length }} palpite{{ 's' if palpites_deste_jogo|length != 1 else '' }}
                        </div>
                        <div style="font-size: 0.85rem; color: var(--verde); margin-top: 0.3rem;">
                            Ver detalhes â†’
                        </div>
                    </div>
                </div>
                
                <!-- Detalhes (inicialmente oculto) -->
                <div id="detalhes-jogo-{{ jogo.id }}" style="display: none; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--cinza-medio);" onclick="event.stopPropagation()">
                    
                    {% set palpites_jogo = [] %}
                    {% for palp in todos_palpites %}
                        {% if palp.jogo_id == jogo.id %}
                            {% set _ = palpites_jogo.append(palp) %}
                        {% endif %}
                    {% endfor %}
                    
                    {% if palpites_jogo|length > 0 %}
                        <!-- Ordena por pontos (se jogo encerrado) -->
                        {% if jogo_encerrado %}
                            {% set palpites_ordenados = palpites_jogo|sort(attribute='pontos_obtidos', reverse=True) %}
                        {% else %}
                            {% set palpites_ordenados = palpites_jogo %}
                        {% endif %}
                        
                        <div style="display: grid; gap: 0.5rem;">
                            {% for palp in palpites_ordenados %}
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; background: var(--fundo); border-radius: 6px;">
                                <div style="display: flex; align-items: center; gap: 0.8rem; flex: 1;">
                                    <span style="font-size: 1.2rem;">
                                        {% if palp.usuario.avatar_tipo == 'sugerido' and palp.usuario.avatar_sugerido_id %}
                                            {{ ['âš½', 'ğŸ†', 'ğŸ‘Ÿ', 'ğŸ¥…', 'ğŸ”¥', 'â­', 'âš¡', 'ğŸ’ª', 'ğŸ¯', 'ğŸ‘Š', 'ğŸš€', 'ğŸ’'][palp.usuario.avatar_sugerido_id - 1] }}
                                        {% else %}
                                            ğŸ‘¤
                                        {% endif %}
                                    </span>
                                    <span style="font-weight: 600;">{{ palp.usuario.nome_completo or palp.usuario.username }}</span>
                                </div>
                                
                                <div style="text-align: center; min-width: 80px;">
                                    <div style="font-size: 1.2rem; font-weight: 600;">
                                        {{ palp.gols_casa_palpite }} x {{ palp.gols_fora_palpite }}
                                    </div>
                                </div>
                                
                                {% if jogo_encerrado %}
                                <div style="text-align: right; min-width: 80px;">
                                    <div style="font-size: 1.2rem; font-weight: 600; 
                                        {% if palp.pontos_obtidos >= 5 %}color: var(--verde);
                                        {% elif palp.pontos_obtidos > 0 %}color: var(--amarelo);
                                        {% else %}color: #e74c3c;{% endif %}">
                                        {{ palp.pontos_obtidos }} pts
                                    </div>
                                </div>
                                {% else %}
                                <div style="text-align: right; min-width: 80px; color: var(--texto-fraco); font-size: 0.85rem;">
                                    Aguardando
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                    <div style="text-align: center; padding: 1rem; color: var(--texto-fraco);">
                        Nenhum palpite registrado
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    <!-- Tab: Regras -->
    <div id="content-regras" style="display: none;">
        <h2 style="margin-bottom: 1.5rem;">ğŸ“‹ Regras de PontuaÃ§Ã£o</h2>
        
        <div style="background: var(--cinza); padding: 2rem; border-radius: 8px; line-height: 1.8;">
            
            <h3 style="color: var(--amarelo); margin-bottom: 1rem;">Sistema de Pontos:</h3>
            
            <ul style="list-style: none; padding: 0; margin-bottom: 2rem;">
                <li style="padding: 0.5rem 0;">âœ… Acertar o resultado (vitÃ³ria/empate): <strong style="color: var(--verde);">{{ bolao.regra.pontos_resultado }} pontos</strong></li>
                {% if bolao.regra.pontos_gols_vencedor > 0 %}
                <li style="padding: 0.5rem 0;">ğŸ¯ Acertar gols do time vencedor: <strong style="color: var(--verde);">+{{ bolao.regra.pontos_gols_vencedor }} pontos</strong></li>
                {% endif %}
                {% if bolao.regra.pontos_gols_perdedor > 0 %}
                <li style="padding: 0.5rem 0;">âŒ Acertar gols do time perdedor: <strong style="color: var(--verde);">+{{ bolao.regra.pontos_gols_perdedor }} pontos</strong></li>
                {% endif %}
                {% if bolao.regra.pontos_diferenca_gols > 0 %}
                <li style="padding: 0.5rem 0;">â•â– Acertar diferenÃ§a de gols: <strong style="color: var(--verde);">+{{ bolao.regra.pontos_diferenca_gols }} pontos</strong></li>
                {% endif %}
            </ul>
            
            {% if bolao.regra.requer_resultado_correto %}
            <div style="background: rgba(255, 215, 0, 0.1); padding: 1rem; border-radius: 6px; margin-bottom: 2rem; border-left: 3px solid var(--amarelo);">
                <strong>âš ï¸ Regra Importante:</strong> Acertos parciais (gols do vencedor, perdedor e diferenÃ§a) sÃ³ contam se vocÃª acertar o resultado do jogo!
            </div>
            {% else %}
            <div style="background: rgba(52, 152, 219, 0.1); padding: 1rem; border-radius: 6px; margin-bottom: 2rem; border-left: 3px solid #3498db;">
                <strong>â„¹ï¸ Regra:</strong> VocÃª pode ganhar pontos parciais mesmo errando o resultado do jogo.
            </div>
            {% endif %}
            
            {% if bolao.regra.ativar_bonus_gols %}
            <div style="background: rgba(231, 76, 60, 0.1); padding: 1rem; border-radius: 6px; margin-bottom: 2rem; border-left: 3px solid #e74c3c;">
                <strong>ğŸ”¥ BÃ´nus ElÃ¡stico:</strong> Jogos com mais de {{ bolao.regra.limite_gols_bonus }} gols ganham +{{ bolao.regra.pontos_por_gol_extra }} ponto por gol extra!
            </div>
            {% endif %}
            
            <h3 style="color: var(--amarelo); margin-top: 2rem; margin-bottom: 1rem;">ğŸ’¡ Exemplos (jogo termina 3x1):</h3>
            
            {% set pts_max = bolao.regra.pontos_resultado + bolao.regra.pontos_gols_vencedor + bolao.regra.pontos_gols_perdedor + bolao.regra.pontos_diferenca_gols %}
            
            <div style="font-family: monospace; font-size: 0.95rem; background: var(--cinza-medio); padding: 1.5rem; border-radius: 6px;">
                <div style="margin-bottom: 0.8rem;">
                    Seu palpite <strong>3x1</strong> â†’ 
                    <span style="color: var(--verde); font-weight: 600;">{{ pts_max }} pontos</span> âœ¨
                    <span style="color: var(--texto-fraco); font-size: 0.85rem;">(placar exato - todos os acertos)</span>
                </div>
                
                {% set pts_2x1 = bolao.regra.pontos_resultado + bolao.regra.pontos_gols_perdedor %}
                <div style="margin-bottom: 0.8rem;">
                    Seu palpite <strong>2x1</strong> â†’ 
                    <span style="color: var(--amarelo); font-weight: 600;">{{ pts_2x1 }} pontos</span>
                    <span style="color: var(--texto-fraco); font-size: 0.85rem;">(resultado + gols do perdedor)</span>
                </div>
                
                {% set pts_3x0 = bolao.regra.pontos_resultado + bolao.regra.pontos_gols_vencedor %}
                <div style="margin-bottom: 0.8rem;">
                    Seu palpite <strong>3x0</strong> â†’ 
                    <span style="color: var(--amarelo); font-weight: 600;">{{ pts_3x0 }} pontos</span>
                    <span style="color: var(--texto-fraco); font-size: 0.85rem;">(resultado + gols do vencedor)</span>
                </div>
                
                <div style="margin-bottom: 0.8rem;">
                    Seu palpite <strong>2x0</strong> â†’ 
                    <span style="color: var(--amarelo); font-weight: 600;">{{ bolao.regra.pontos_resultado }} pontos</span>
                    <span style="color: var(--texto-fraco); font-size: 0.85rem;">(apenas resultado)</span>
                </div>
                
                <div>
                    Seu palpite <strong>1x3</strong> â†’ 
                    <span style="color: #e74c3c; font-weight: 600;">0 pontos</span>
                    <span style="color: var(--texto-fraco); font-size: 0.85rem;">(errou o resultado)</span>
                </div>
            </div>
            
        </div>
    </div>

    {% if eh_dono %}
    <div id="content-participantes" style="display: none;">
        <h2 style="margin-bottom: 1.5rem;">Participantes</h2>
        
        <!-- SolicitaÃ§Ãµes Pendentes -->
        {% set solicitacoes = solicitacoes_pendentes %}
        {% if solicitacoes|length > 0 %}
        <div style="background: var(--amarelo); color: #000; padding: 1rem; border-radius: 6px; margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1rem;">â³ SolicitaÃ§Ãµes Pendentes ({{ solicitacoes|length }})</h3>
            <div style="display: grid; gap: 0.5rem;">
                {% for sol in solicitacoes %}
                <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 1.5rem;">
                            {% if sol.usuario.avatar_tipo == 'sugerido' and sol.usuario.avatar_sugerido_id %}
                                {{ ['âš½', 'ğŸ†', 'ğŸ‘Ÿ', 'ğŸ¥…', 'ğŸ”¥', 'â­', 'âš¡', 'ğŸ’ª', 'ğŸ¯', 'ğŸ‘Š', 'ğŸš€', 'ğŸ’'][sol.usuario.avatar_sugerido_id - 1] }}
                            {% else %}
                                ğŸ‘¤
                            {% endif %}
                        </span>
                        <div>
                            <div style="font-weight: 600;">{{ sol.usuario.nome_completo or sol.usuario.username }}</div>
                            <div style="font-size: 0.85rem; opacity: 0.8;">Solicitou em {{ sol.data_solicitacao|brasilia }}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="responderSolicitacao({{ sol.id }}, 'aprovar')" 
                            style="background: #00a651; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            âœ“ Aprovar
                        </button>
                        <button onclick="responderSolicitacao({{ sol.id }}, 'rejeitar')" 
                            style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            âœ— Rejeitar
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Participantes Aprovados -->
        <div style="background: var(--cinza); padding: 1.5rem; border-radius: 8px;">
            <p style="color: var(--texto-fraco); margin-bottom: 1rem;">{{ bolao.participantes.count() }} participantes</p>
            {% for part in bolao.participantes.all() %}
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.8rem; border-bottom: 1px solid var(--cinza-medio);">
                <span style="font-size: 1.5rem;">
                    {% if part.usuario.avatar_tipo == 'sugerido' and part.usuario.avatar_sugerido_id %}
                        {{ ['âš½', 'ğŸ†', 'ğŸ‘Ÿ', 'ğŸ¥…', 'ğŸ”¥', 'â­', 'âš¡', 'ğŸ’ª', 'ğŸ¯', 'ğŸ‘Š', 'ğŸš€', 'ğŸ’'][part.usuario.avatar_sugerido_id - 1] }}
                    {% else %}
                        ğŸ‘¤
                    {% endif %}
                </span>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">{{ part.usuario.nome_completo or part.usuario.username }}</div>
                    <div style="font-size: 0.85rem; color: var(--texto-fraco);">{{ part.pontos_totais }} pontos</div>
                </div>
                <div style="font-size: 0.8rem; color: var(--texto-fraco);">
                    Entrou em {{ part.data_entrada|brasilia }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}
{% block scripts %}
<script>

function mostrarTab(tab) {
    // Esconde todos
    document.getElementById('content-ranking').style.display = 'none';
    document.getElementById('content-palpites').style.display = 'none';
    document.getElementById('content-todos-palpites').style.display = 'none';
    document.getElementById('content-regras').style.display = 'none';
    {% if eh_dono %}
    document.getElementById('content-participantes').style.display = 'none';
    {% endif %}
    
    // Remove destaque
    document.getElementById('tab-ranking').style.color = 'var(--texto-fraco)';
    document.getElementById('tab-ranking').style.borderBottom = '3px solid transparent';
    document.getElementById('tab-regras').style.color = 'var(--texto-fraco)';
    document.getElementById('tab-regras').style.borderBottom = '3px solid transparent';
    document.getElementById('tab-palpites').style.color = 'var(--texto-fraco)';
    document.getElementById('tab-palpites').style.borderBottom = '3px solid transparent';
    document.getElementById('tab-todos-palpites').style.color = 'var(--texto-fraco)';
    document.getElementById('tab-todos-palpites').style.borderBottom = '3px solid transparent';
    {% if eh_dono %}
    document.getElementById('tab-participantes').style.color = 'var(--texto-fraco)';
    document.getElementById('tab-participantes').style.borderBottom = '3px solid transparent';
    {% endif %}
    
    // Mostra selecionado
    document.getElementById('content-' + tab).style.display = 'block';
    document.getElementById('tab-' + tab).style.color = 'var(--verde)';
    document.getElementById('tab-' + tab).style.borderBottom = '3px solid var(--verde)';
}


function salvarPalpite(jogoId, bolaoId) {
    const golsCasa = document.getElementById('casa-' + jogoId).value;
    const golsFora = document.getElementById('fora-' + jogoId).value;
    
    if (golsCasa === '' || golsFora === '') {
        alert('Preencha o placar completo');
        return;
    }
    
    fetch('/salvar_palpite', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            bolao_id: bolaoId,
            jogo_id: jogoId,
            gols_casa: parseInt(golsCasa),
            gols_fora: parseInt(golsFora)
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.sucesso) {
            alert('Palpite salvo!');
        } else {
            alert('Erro: ' + (data.erro || 'Desconhecido'));
        }
    })
    .catch(err => {
        alert('Erro ao salvar palpite');
    });
}

function filtrarJogos() {
    const filtroStatus = document.getElementById('filtro-status').value;
    const filtroRodada = document.getElementById('filtro-rodada').value;
    const jogos = document.querySelectorAll('.jogo-item');
    
    jogos.forEach(jogo => {
        let mostrar = true;
        
        // Filtro de status
        if (filtroStatus !== 'todos') {
            if (jogo.dataset.status !== filtroStatus) {
                mostrar = false;
            }
        }
        
        // Filtro de rodada
        if (filtroRodada !== '' && jogo.dataset.rodada !== filtroRodada) {
            mostrar = false;
        }
        
        jogo.style.display = mostrar ? 'block' : 'none';
    });
}
function responderSolicitacao(solicitacaoId, acao) {
    fetch('/responder_solicitacao', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            solicitacao_id: solicitacaoId,
            acao: acao
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.sucesso) {
            location.reload();
        } else {
            alert('Erro: ' + (data.erro || 'Desconhecido'));
        }
    });
}

function atualizarJogosBolao(bolaoId) {
    const btn = document.getElementById('btn-atualizar-jogos');
    const msg = document.getElementById('msg-atualizar-jogos');
    
    btn.disabled = true;
    btn.textContent = 'â³ Atualizando...';
    msg.style.display = 'none';
    
    fetch(`/atualizar_jogos_bolao/${bolaoId}`, { method: 'POST' })
    .then(res => res.json())
    .then(data => {
        msg.style.display = 'block';
        if (data.sucesso) {
            msg.style.color = 'var(--verde)';
            msg.textContent = `âœ… ${data.novos_jogos} novos jogos importados!`;
            setTimeout(() => location.reload(), 2000);
        } else {
            msg.style.color = '#e74c3c';
            msg.textContent = 'âŒ ' + (data.erro || 'Erro desconhecido');
        }
        btn.disabled = false;
        btn.textContent = 'ğŸ”„ Atualizar Jogos';
    })
    .catch(err => {
        msg.style.display = 'block';
        msg.style.color = '#e74c3c';
        msg.textContent = 'âŒ Erro ao atualizar';
        btn.disabled = false;
        btn.textContent = 'ğŸ”„ Atualizar Jogos';
    });
}

function toggleDetalhesJogo(jogoId) {
    const detalhes = document.getElementById('detalhes-jogo-' + jogoId);
    if (detalhes.style.display === 'none') {
        detalhes.style.display = 'block';
    } else {
        detalhes.style.display = 'none';
    }
    event.stopPropagation();
}
function copiarLink() {
    const link = window.location.origin + '/entrar_bolao?codigo={{ bolao.codigo_convite }}';
    navigator.clipboard.writeText(link).then(() => {
        const msg = document.getElementById('msg-compartilhar');
        msg.textContent = 'âœ… Link copiado!';
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', 3000);
    });
}

function compartilharWhatsApp() {
    const texto = encodeURIComponent('ğŸ¯ Entre no meu bolÃ£o "{{ bolao.nome }}"!\n\nCÃ³digo: {{ bolao.codigo_convite }}\n\nLink: ' + window.location.origin + '/entrar_bolao?codigo={{ bolao.codigo_convite }}');
    window.open('https://wa.me/?text=' + texto, '_blank');
}
</script>
<style>
@media (max-width: 768px) {
    /* CabeÃ§alho do bolÃ£o */
    .bolao-header {
        flex-direction: column !important;
        gap: 1rem !important;
    }
    
    .bolao-header > div {
        width: 100% !important;
        text-align: left !important;
    }
    
    h1 {
        font-size: 1.3rem !important;
    }
    
    /* Tabs */
    nav a, .tab-link {
        padding: 0.8rem 0.8rem !important;
        font-size: 0.85rem !important;
    }
    
    /* Tabela de ranking */
    .ranking-table {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .ranking-table table {
        min-width: 100%;
        font-size: 0.85rem;
    }
    
    .ranking-table td, 
    .ranking-table th {
        padding: 0.6rem 0.4rem !important;
    }
    
    /* Cards de jogos para palpitar */
    .jogo-card {
        padding: 1rem !important;
    }
    
    .jogo-card > div {
        grid-template-columns: 1fr auto 1fr !important;
        gap: 0.5rem !important;
    }
    
    .jogo-card input[type="number"] {
        width: 50px !important;
        padding: 0.4rem !important;
        font-size: 1rem !important;
    }
    
    .jogo-card button {
        padding: 0.4rem 0.6rem !important;
        font-size: 0.8rem !important;
    }
    
    /* Filtros */
    .filtros-container {
        flex-direction: column !important;
        gap: 0.5rem !important;
    }
    
    .filtros-container select {
        width: 100% !important;
    }
    
    /* BotÃ£o atualizar jogos */
    #btn-atualizar-jogos {
        font-size: 0.8rem !important;
        padding: 0.4rem 0.8rem !important;
    }
}
</style>

{% endblock %}
