{% extends "base.html" %}
{% block title %}Adicionar Competição{% endblock %}
{% block content %}
<h1>Adicionar Nova Competição</h1>
<div style="margin: 2rem 0;">
    <a href="/admin/competicoes" style="color: var(--texto-fraco); text-decoration: none;">← Voltar para Competições</a>
</div>
<div style="background: var(--cinza); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
    <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco);">ANO/TEMPORADA</label>
    <select onchange="window.location.href='/admin/listar_ligas_api?ano=' + this.value" style="background: var(--cinza-medio); color: var(--texto); border: 1px solid var(--cinza-medio); padding: 0.6rem 1rem; border-radius: 6px; font-size: 0.95rem;">
        <option value="2024" {% if ano == 2024 %}selected{% endif %}>2024</option>
        <option value="2025" {% if ano == 2025 %}selected{% endif %}>2025</option>
        <option value="2026" {% if ano == 2026 %}selected{% endif %}>2026</option>
        <option value="2027" {% if ano == 2027 %}selected{% endif %}>2027</option>
    </select>
</div>
<h2>Ligas Disponíveis ({{ ano }})</h2>
<div style="display: grid; gap: 1rem; margin-top: 1.5rem;">
    {% for liga in ligas %}
    <div style="background: var(--cinza); padding: 1.5rem; border-radius: 8px; display: flex; align-items: center; gap: 1.5rem;">
        <img src="{{ liga.logo }}" alt="{{ liga.nome }}" style="width: 50px; height: 50px; object-fit: contain;">
        <div style="flex: 1;">
            <h3 style="color: var(--texto); margin-bottom: 0.3rem; font-size: 1.1rem;">{{ liga.nome }}</h3>
            <div style="color: var(--texto-fraco); font-size: 0.85rem;">{{ liga.pais }} • {{ liga.tipo }}</div>
        </div>
        <button onclick="importarLiga({{ liga.api_id }}, {{ ano }}, '{{ liga.nome }}')" id="btn-{{ liga.api_id }}" style="background: var(--verde); color: #000; border: none; padding: 0.6rem 1.5rem; border-radius: 6px; font-weight: 600; cursor: pointer; white-space: nowrap;">Importar Jogos</button>
    </div>
    {% endfor %}
</div>
{% if ligas|length == 0 %}
<div style="text-align: center; padding: 3rem; color: var(--texto-fraco);">Nenhuma liga encontrada para {{ ano }}.</div>
{% endif %}
<div id="mensagem" style="position: fixed; bottom: 2rem; right: 2rem; background: var(--cinza); padding: 1rem 1.5rem; border-radius: 8px; border-left: 3px solid var(--verde); display: none; box-shadow: 0 4px 20px rgba(0,0,0,0.5);"></div>
{% endblock %}
{% block scripts %}
<script>
function importarLiga(leagueId, ano, nome) {
    const btn = document.getElementById('btn-' + leagueId);
    const mensagem = document.getElementById('mensagem');
    btn.disabled = true;
    btn.textContent = '⏳ Importando...';
    fetch(`/admin/importar_competicao/${leagueId}/${ano}`)
    .then(res => res.json())
    .then(data => {
        if (data.sucesso) {
            btn.textContent = '✅ Importado';
            btn.style.background = '#00a651';
            mensagem.innerHTML = `<strong>${data.competicao}</strong><br>${data.jogos_importados} jogos importados`;
            mensagem.style.display = 'block';
            setTimeout(() => mensagem.style.display = 'none', 5000);
        } else {
            btn.disabled = false;
            btn.textContent = 'Importar Jogos';
            alert('Erro ao importar: ' + (data.erro || 'Desconhecido'));
        }
    })
    .catch(err => {
        btn.disabled = false;
        btn.textContent = 'Importar Jogos';
        alert('Erro na requisição');
    });
}
</script>
{% endblock %}