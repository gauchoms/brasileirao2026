{% extends "base.html" %}

{% block title %}Criar Bolão{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 2rem auto;">
    <h1 style="margin-bottom: 2rem;">Criar Novo Bolão</h1>

    {% if erro %}
    <div style="background: #e74c3c; color: white; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
        {{ erro }}
    </div>
    {% endif %}

    <form method="POST" id="form-criar-bolao" style="background: var(--cinza); padding: 2rem; border-radius: 8px;">
        
        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">NOME DO BOLÃO</label>
            <input type="text" name="nome" required placeholder="Ex: Bolão da Copa 2026"
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIPO DE BOLÃO</label>
            <select name="tipo_bolao" id="tipo-bolao" onchange="mostrarCampos()" required
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
                <option value="campeonato_completo">Campeonato Completo</option>
                <option value="time_campeonato">Time em um Campeonato</option>
                <option value="time_ano_completo">Time em Todas as Competições do Ano</option>
            </select>
        </div>

        <div id="campos-campeonato-completo" style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">COMPETIÇÃO</label>
            <select name="competicao_id" id="select-competicao"
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
                <option value="">Selecione uma competição</option>
                {% for comp in competicoes %}
                <option value="{{ comp.id }}">{{ comp.nome }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="campos-time-campeonato" style="display: none;">
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">COMPETIÇÃO</label>
                <select name="competicao_id_time" id="select-competicao-time" onchange="carregarTimesCampeonato()"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="">Selecione uma competição</option>
                    {% for comp in competicoes %}
                    <option value="{{ comp.id }}">{{ comp.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIME</label>
                <select name="time_id_campeonato" id="select-time-campeonato"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="">Escolha a competição primeiro</option>
                </select>
            </div>
        </div>

        <div id="campos-time-ano" style="display: none;">
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIME</label>
                <select name="time_id_ano" id="select-time-ano"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="">Selecione um time</option>
                    {% for time in times %}
                    <option value="{{ time.id }}">{{ time.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">ANO</label>
                <select name="ano"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026" selected>2026</option>
                    <option value="2027">2027</option>
                </select>
            </div>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">REGRA DE PONTUAÇÃO</label>
            <select name="regra_pontuacao_id" required
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
                {% for regra in regras %}
                <option value="{{ regra.id }}">
                    {{ regra.nome }} (Placar exato: {{ regra.pontos_placar_exato }}pts, Resultado: {{ regra.pontos_resultado_certo }}pts)
                </option>
                {% endfor %}
            </select>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIPO DE ACESSO</label>
            <select name="tipo_acesso"
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
                <option value="publico">Público (qualquer um pode entrar com o código)</option>
                <option value="privado">Privado (você precisa aprovar cada participante)</option>
            </select>
        </div>

        <div style="background: var(--cinza-medio); padding: 1rem; border-radius: 6px; margin-bottom: 2rem;">
            <div style="color: var(--texto-fraco); font-size: 0.9rem; margin-bottom: 0.5rem;">VALOR</div>
            <div style="font-size: 1.5rem; font-weight: 600; color: var(--amarelo);">R$ 15,00</div>
            <div style="color: var(--texto-fraco); font-size: 0.8rem; margin-top: 0.5rem;">
                Pagamento via Mercado Pago após criar o bolão
            </div>
        </div>

        <button type="submit" 
            style="width: 100%; padding: 1rem; background: var(--verde); color: #000; border: none; 
                   border-radius: 6px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: opacity 0.2s;"
            onmouseover="this.style.opacity='0.85'" 
            onmouseout="this.style.opacity='1'">
            Criar Bolão e Pagar R$ 15,00
        </button>

        <div style="text-align: center; margin-top: 1rem;">
            <a href="/meus_boloes" style="color: var(--texto-fraco); text-decoration: none; font-size: 0.9rem;">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
function mostrarCampos() {
    const tipo = document.getElementById('tipo-bolao').value;
    
    document.getElementById('campos-campeonato-completo').style.display = 'none';
    document.getElementById('campos-time-campeonato').style.display = 'none';
    document.getElementById('campos-time-ano').style.display = 'none';
    
    document.getElementById('select-competicao').removeAttribute('required');
    document.getElementById('select-time-campeonato').removeAttribute('required');
    document.getElementById('select-time-ano').removeAttribute('required');
    
    if (tipo === 'campeonato_completo') {
        document.getElementById('campos-campeonato-completo').style.display = 'block';
        document.getElementById('select-competicao').setAttribute('required', 'required');
    } else if (tipo === 'time_campeonato') {
        document.getElementById('campos-time-campeonato').style.display = 'block';
        document.getElementById('select-competicao-time').setAttribute('required', 'required');
        document.getElementById('select-time-campeonato').setAttribute('required', 'required');
    } else if (tipo === 'time_ano_completo') {
        document.getElementById('campos-time-ano').style.display = 'block';
        document.getElementById('select-time-ano').setAttribute('required', 'required');
    }
}

function carregarTimesCampeonato() {
    const competicaoId = document.getElementById('select-competicao-time').value;
    const selectTime = document.getElementById('select-time-campeonato');
    
    if (!competicaoId) {
        selectTime.innerHTML = '<option value="">Escolha a competição primeiro</option>';
        return;
    }
    
    fetch(`/api/times_por_competicao/${competicaoId}`)
        .then(res => res.json())
        .then(data => {
            selectTime.innerHTML = '<option value="">Selecione um time</option>';
            data.times.forEach(time => {
                selectTime.innerHTML += `<option value="${time.id}">${time.nome}</option>`;
            });
        });
}
</script>
{% endblock %}