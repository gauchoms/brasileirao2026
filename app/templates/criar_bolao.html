{% extends "base.html" %}

{% block title %}Criar Bol√£o{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 2rem auto;">
    <h1 style="margin-bottom: 2rem;">Criar Novo Bol√£o</h1>

    {% if erro %}
    <div style="background: #e74c3c; color: white; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
        {{ erro }}
    </div>
    {% endif %}

    <form method="POST" id="form-criar-bolao" style="background: var(--cinza); padding: 2rem; border-radius: 8px;">
        
        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">NOME DO BOL√ÉO</label>
            <input type="text" name="nome" required placeholder="Ex: Bol√£o da Copa 2026"
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIPO DE BOL√ÉO</label>
            <select name="tipo_bolao" id="tipo-bolao" onchange="mostrarCampos()" required
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
                <option value="campeonato_completo">Campeonato Completo</option>
                <option value="time_campeonato">Time em um Campeonato</option>
                <option value="time_ano_completo">Time em Todas as Competi√ß√µes do Ano</option>
            </select>
        </div>

        <div id="campos-campeonato-completo" style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">COMPETI√á√ÉO</label>
            <select name="competicao_id" id="select-competicao"
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
                <option value="">Selecione uma competi√ß√£o</option>
                {% for comp in competicoes %}
                <option value="{{ comp.id }}">{{ comp.nome }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="campos-time-campeonato" style="display: none;">
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">COMPETI√á√ÉO</label>
                <select name="competicao_id_time" id="select-competicao-time" onchange="carregarTimesCampeonato()"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="">Selecione uma competi√ß√£o</option>
                    {% for comp in competicoes %}
                    <option value="{{ comp.id }}">{{ comp.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIME</label>
                <select name="time_id_campeonato" id="select-time-campeonato"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="">Escolha a competi√ß√£o primeiro</option>
                </select>
            </div>
        </div>

        <div id="campos-time-ano" style="display: none;">
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIME</label>
                <select name="time_id_ano" id="select-time-ano"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="">Selecione um time</option>
                    {% for time in times %}
                    <option value="{{ time.id }}">{{ time.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">ANO</label>
                <select name="ano"
                    style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                           border-radius: 6px; color: var(--texto); font-size: 1rem;">
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026" selected>2026</option>
                    <option value="2027">2027</option>
                </select>
            </div>
        </div>

       <!-- Configura√ß√£o de Pontua√ß√£o -->
        <div style="background: var(--cinza-medio); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
            <h3 style="margin-bottom: 1rem; color: var(--amarelo);">‚öôÔ∏è Sistema de Pontua√ß√£o</h3>
            
            <!-- Escolha do Modo -->
            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Escolha o Modo:</label>
                
                <label style="display: flex; align-items: start; gap: 0.8rem; padding: 1rem; background: var(--cinza); border-radius: 6px; margin-bottom: 0.5rem; cursor: pointer;">
                    <input type="radio" name="modo_pontuacao" value="placar_exato" onchange="atualizarCamposPontuacao()" 
                        style="margin-top: 0.2rem; width: 20px; height: 20px;">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 0.3rem;">üéØ Modo A: S√≥ Placar Exato</div>
                        <div style="font-size: 0.85rem; color: var(--texto-fraco);">Pontua apenas se acertar o placar exato. Tudo ou nada!</div>
                    </div>
                </label>
                
                <label style="display: flex; align-items: start; gap: 0.8rem; padding: 1rem; background: var(--cinza); border-radius: 6px; margin-bottom: 0.5rem; cursor: pointer;">
                    <input type="radio" name="modo_pontuacao" value="acertos_parciais" onchange="atualizarCamposPontuacao()" checked
                        style="margin-top: 0.2rem; width: 20px; height: 20px;">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 0.3rem;">üìä Modo B: Acertos Parciais</div>
                        <div style="font-size: 0.85rem; color: var(--texto-fraco);">Pontua por placar exato, gols do vencedor, perdedor e diferen√ßa de gols</div>
                    </div>
                </label>
                
                <label style="display: flex; align-items: start; gap: 0.8rem; padding: 1rem; background: var(--cinza); border-radius: 6px; cursor: pointer;">
                    <input type="radio" name="modo_pontuacao" value="com_bonus" onchange="atualizarCamposPontuacao()"
                        style="margin-top: 0.2rem; width: 20px; height: 20px;">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 0.3rem;">üî• Modo C: Com B√¥nus de Jogos El√°sticos</div>
                        <div style="font-size: 0.85rem; color: var(--texto-fraco);">Acertos parciais + b√¥nus extra para jogos com muitos gols</div>
                    </div>
                </label>
            </div>
            
            <!-- Configura√ß√£o de Pontos -->
            <div id="config-pontos">
                
                <!-- Modo A: S√≥ Placar Exato -->
                <div id="campos-modo-a" style="display: none;">
                    <div>
                        <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">Pontos por Placar Exato</label>
                        <input type="number" name="pts_placar_exato_a" value="10" min="1"
                            style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                   border-radius: 6px; color: var(--texto);">
                    </div>
                </div>
                
                <!-- Modo B: Acertos Parciais -->
                <div id="campos-modo-b">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">üéØ Placar Exato</label>
                            <input type="number" name="pts_placar_exato_b" value="10" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">üèÜ Gols do Vencedor</label>
                            <input type="number" name="pts_gols_vencedor_b" value="3" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">‚ùå Gols do Perdedor</label>
                            <input type="number" name="pts_gols_perdedor_b" value="1" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">‚ûï‚ûñ Diferen√ßa de Gols</label>
                            <input type="number" name="pts_diferenca_gols_b" value="2" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                    </div>
                </div>
                
                <!-- Modo C: Com B√¥nus -->
                <div id="campos-modo-c" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">üéØ Placar Exato</label>
                            <input type="number" name="pts_placar_exato_c" value="10" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">üèÜ Gols do Vencedor</label>
                            <input type="number" name="pts_gols_vencedor_c" value="3" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">‚ùå Gols do Perdedor</label>
                            <input type="number" name="pts_gols_perdedor_c" value="1" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">‚ûï‚ûñ Diferen√ßa de Gols</label>
                            <input type="number" name="pts_diferenca_gols_c" value="2" min="0"
                                style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                       border-radius: 6px; color: var(--texto);">
                        </div>
                    </div>
                    
                    <div style="border-top: 1px solid var(--cinza); padding-top: 1rem;">
                        <div style="font-weight: 600; margin-bottom: 1rem;">üî• B√¥nus por Jogos El√°sticos</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">M√≠nimo de Gols Totais</label>
                                <input type="number" name="limite_gols_bonus" value="4" min="1"
                                    style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                           border-radius: 6px; color: var(--texto);">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 0.3rem; color: var(--texto-fraco); font-size: 0.85rem;">Pontos por Gol Extra</label>
                                <input type="number" name="pts_por_gol_extra" value="1" min="1"
                                    style="width: 100%; padding: 0.6rem; background: var(--cinza); border: 1px solid var(--cinza); 
                                           border-radius: 6px; color: var(--texto);">
                            </div>
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255,215,0,0.1); border-radius: 4px; font-size: 0.8rem; color: var(--texto-fraco);">
                            üí° Exemplo: Se configurar m√≠nimo 4 gols e 1 ponto por gol extra, um jogo 3x2 (5 gols) dar√° 1 ponto extra
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--texto-fraco); font-size: 0.9rem;">TIPO DE ACESSO</label>
            <select name="tipo_acesso"
                style="width: 100%; padding: 0.8rem; background: var(--cinza-medio); border: 1px solid var(--cinza-medio); 
                       border-radius: 6px; color: var(--texto); font-size: 1rem;">
                <option value="publico">P√∫blico (qualquer um pode entrar com o c√≥digo)</option>
                <option value="privado">Privado (voc√™ precisa aprovar cada participante)</option>
            </select>
        </div>

        <div style="background: var(--cinza-medio); padding: 1rem; border-radius: 6px; margin-bottom: 2rem;">
            <div style="color: var(--texto-fraco); font-size: 0.9rem; margin-bottom: 0.5rem;">VALOR</div>
            <div style="font-size: 1.5rem; font-weight: 600; color: var(--amarelo);">R$ 15,00</div>
            <div style="color: var(--texto-fraco); font-size: 0.8rem; margin-top: 0.5rem;">
                Pagamento via Mercado Pago ap√≥s criar o bol√£o
            </div>
        </div>

        <button type="submit" 
            style="width: 100%; padding: 1rem; background: var(--verde); color: #000; border: none; 
                   border-radius: 6px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: opacity 0.2s;"
            onmouseover="this.style.opacity='0.85'" 
            onmouseout="this.style.opacity='1'">
            Criar Bol√£o e Pagar R$ 15,00
        </button>

        <div style="text-align: center; margin-top: 1rem;">
            <a href="/meus_boloes" style="color: var(--texto-fraco); text-decoration: none; font-size: 0.9rem;">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
function mostrarCampos() {
    const tipo = document.getElementById('tipo-bolao').value;
    
    document.getElementById('campos-campeonato-completo').style.display = 'none';
    document.getElementById('campos-time-campeonato').style.display = 'none';
    document.getElementById('campos-time-ano').style.display = 'none';
    
    document.getElementById('select-competicao').removeAttribute('required');
    document.getElementById('select-time-campeonato').removeAttribute('required');
    document.getElementById('select-time-ano').removeAttribute('required');
    
    if (tipo === 'campeonato_completo') {
        document.getElementById('campos-campeonato-completo').style.display = 'block';
        document.getElementById('select-competicao').setAttribute('required', 'required');
    } else if (tipo === 'time_campeonato') {
        document.getElementById('campos-time-campeonato').style.display = 'block';
        document.getElementById('select-competicao-time').setAttribute('required', 'required');
        document.getElementById('select-time-campeonato').setAttribute('required', 'required');
    } else if (tipo === 'time_ano_completo') {
        document.getElementById('campos-time-ano').style.display = 'block';
        document.getElementById('select-time-ano').setAttribute('required', 'required');
    }
}

function carregarTimesCampeonato() {
    const competicaoId = document.getElementById('select-competicao-time').value;
    const selectTime = document.getElementById('select-time-campeonato');
    
    if (!competicaoId) {
        selectTime.innerHTML = '<option value="">Escolha a competi√ß√£o primeiro</option>';
        return;
    }
    
    fetch(`/api/times_por_competicao/${competicaoId}`)
        .then(res => res.json())
        .then(data => {
            selectTime.innerHTML = '<option value="">Selecione um time</option>';
            data.times.forEach(time => {
                selectTime.innerHTML += `<option value="${time.id}">${time.nome}</option>`;
            });
        });
}

function toggleBonusGols() {
    const checkbox = document.getElementById('checkbox-bonus');
    const campos = document.getElementById('campos-bonus');
    campos.style.display = checkbox.checked ? 'block' : 'none';

}

function atualizarCamposPontuacao() {
    const modo = document.querySelector('input[name="modo_pontuacao"]:checked').value;
    
    document.getElementById('campos-modo-a').style.display = 'none';
    document.getElementById('campos-modo-b').style.display = 'none';
    document.getElementById('campos-modo-c').style.display = 'none';
    
    if (modo === 'placar_exato') {
        document.getElementById('campos-modo-a').style.display = 'block';
    } else if (modo === 'acertos_parciais') {
        document.getElementById('campos-modo-b').style.display = 'block';
    } else if (modo === 'com_bonus') {
        document.getElementById('campos-modo-c').style.display = 'block';
    }
}

</script>
{% endblock %}